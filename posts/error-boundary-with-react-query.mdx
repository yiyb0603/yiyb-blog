---
title: Error Boundary, React-Queryì™€ í•¨ê»˜ ì‚¬ìš©í•´ë³´ê¸°
description: ë¦¬ì•¡íŠ¸ì˜ Error Boundaryë¥¼ React-Query ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í•¨ê»˜ ì‚¬ìš©í•´ë´…ì‹œë‹¤.
category: React-Query
createdAt: 2023-06-28
thumbnail: https://github.com/yiyb0603/yiyb-blog/assets/50941453/154a16c2-f5a6-489f-9639-85685bfe794a
---

ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ ë¦¬ì•¡íŠ¸ì˜ ì£¼ìš” ê¸°ëŠ¥ì¤‘ í•˜ë‚˜ì¸ `Error Boundary`ë¥¼ `React-Query` ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í•¨ê»˜ ì‚¬ìš©í•´ë³´ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ğŸ˜ƒ

## 1. Error Boundaryë€? ğŸ¤”
`Error Boundary (ì—ëŸ¬ ë°”ìš´ë”ë¦¬)`ëŠ” ë¦¬ì•¡íŠ¸ 16ë²„ì „ì—ì„œ ì¶”ê°€ëœ ê¸°ëŠ¥ìœ¼ë¡œ, **í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë¥¼ ì¡ì•„ì£¼ëŠ”** ì»´í¬ë„ŒíŠ¸ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
<br />
ë¬¼ë¡ , `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ê¸°ë³¸ì ì¸ ì˜¤ë¥˜ì²˜ë¦¬ëŠ” ê°€ëŠ¥í•©ë‹ˆë‹¤.

```tsx
const MyComponent = () => {
  const {
    data,
    error,
  } = useQuery(...);

  if (error) {
    return <p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”!</p>
  }

  return (
    <div>
      {data.data.map(...)}
    </div>
  );
}
```

ìœ„ì™€ ê°™ì€ í˜•ì‹ì˜ ì½”ë“œëŠ” **ëª…ë ¹í˜•** ì½”ë“œë¡œ ë¶„ë¥˜ê°€ ë˜ëŠ”ë°ìš”. ë¬¼ë¡  ëª…ë ¹í˜• ì½”ë“œê°€ ë‚˜ì˜ì§„ ì•Šì§€ë§Œ, ëª…ë ¹ì— ëŒ€í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê²Œë˜ë©´ ì½”ë“œ ë¼ì¸ì´ ì ì  ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<br />
ê·¸ë¦¬ê³  ìœ„ì™€ê°™ì€ ëª…ë ¹í˜• ì½”ë“œë¥¼ `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ë©´ ê°„í¸í•˜ê²Œ, ê·¸ë¦¬ê³  **ì„ ì–¸ì **ì¸ ì˜¤ë¥˜ì²˜ë¦¬ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ëŠ” ì•„ë˜ ì„¹ì…˜ì„ í†µí•´ì„œ ì•Œì•„ë´…ì‹œë‹¤!

## 2. ì»´í¬ë„ŒíŠ¸ ì œì‘ âš’ï¸
ì°¸ê³ ë¡œ `Error Boundary` ì»´í¬ë„ŒíŠ¸ëŠ” ë¦¬ì•¡íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ ê·¸ì € ë¡! import! ë§Œ í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²ƒì´ ì•„ë‹ˆê³ , ë¦¬ì•¡íŠ¸ì˜ **í´ë˜ìŠ¤í˜• ì»´í¬ë„ŒíŠ¸ì˜ ë©”ì†Œë“œ**ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•´ì„œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ, í˜„ì¬ëŠ” **í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸**ë¥¼ ì‚¬ìš©í•´ì„œ `Error Boundary`ë¥¼ êµ¬í˜„ í•˜ëŠ”ê²ƒì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ğŸ˜¥
<br />
ë¨¼ì €, **ErrorBoundary.tsx** ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ íŒŒì¼ì„ ë§Œë“¤ê³ , ì•„ë˜ì˜ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ê° ì½”ë“œì— ëŒ€í•œ ì„¤ëª…ì€ ì£¼ì„ì„ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ğŸ˜›

```tsx
import { Component, ReactNode, ErrorInfo } from 'react';

type ErrorBoundaryState = {
  hasError: boolean;
  error: Error | null;
}

type ErrorBoundaryProps = {
  children: ReactNode;
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);

    this.state = {
      hasError: false, // ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ state ìƒíƒœë¡œ ì €ì¥í•©ë‹ˆë‹¤.
      error: null, // ë°œìƒí•œ ì˜¤ë¥˜ì˜ ì •ë³´ë¥¼ state ìƒíƒœë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    };
  }

  /*
    getDerivedStateFromError ë©”ì†Œë“œëŠ” í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì˜¤ë¥˜ì˜ ì •ë³´ë¥¼ returnì„ í†µí•´ì„œ Stateì— ì €ì¥í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
    error íŒŒë¼ë¯¸í„°ëŠ” ë°œìƒí•œ ì˜¤ë¥˜ì˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
  */
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    // ì˜¤ë¥˜ ìƒíƒœ ì—…ë°ì´íŠ¸
    return {
      hasError: true,
      error,
    };
  }

  /* componentDidCatch ë©”ì†Œë“œëŠ” ì˜¤ë¥˜ ì •ë³´ì™€ ìƒì„¸ ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì£¼ë¡œ ì˜¤ë¥˜ë¥¼ ë¡œê¹…í•´ì•¼ í• ë•Œ í•´ë‹¹ ë©”ì†Œë“œì— ì ‘ê·¼í•´ì„œ ë¡œê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  */
  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {
    console.log({ error, errorInfo })
  }

  render() {
    const { state, props } = this;

    const { hasError } = state;

    const { children } = props;

    // ì˜¤ë¥˜ ë°œìƒ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ì—¬, ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ë•Œ ì¡°ê±´ë¶€ ë Œë”ë§ ì²˜ë¦¬ë¥¼ í•´ì¤ë‹ˆë‹¤.
    return hasError ? <div>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”!</div> : children;
  }
}
```

ì¼ë‹¨ ìœ„ì²˜ëŸ¼ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ `Error Boundary`ë¥¼ êµ¬í˜„í•  ìˆ˜ëŠ” ìˆëŠ”ë°ìš”, í•˜ì§€ë§Œ ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ ë‹¨ì ì´ ëª‡ê°œ ì¡´ì¬í•©ë‹ˆë‹¤.

1. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ë•Œ ë³´ì—¬ì£¼ëŠ” UIê°€ ì œí•œì ì´ë‹¤.
2. Aë¼ëŠ” ì˜¤ë¥˜ì¼ë•ŒëŠ” Bë¥¼ ë³´ì—¬ì£¼ê³ , Cë¼ëŠ” ì˜¤ë¥˜ì¼ë•ŒëŠ” Dë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤.
3. ë§Œì•½ API ì˜¤ë¥˜ê°€ ë‚¬ì„ë•Œ ì¬ìš”ì²­ ì²˜ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ”ë°, ì–´ë–»ê²Œ êµ¬í˜„í•´ì•¼ í•˜ëŠ”ê°€?

ìœ„ ë‘ê°€ì§€ ë¬¸ì œì¤‘ ê°€ì¥ ë¨¼ì € 1ë²ˆê³¼ 2ë²ˆ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. `fallback` propsì—ëŠ” **ì¸ìë¥¼ ë„˜ê²¨ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸** í˜•íƒœë¡œ propsë¥¼ ë°›ë„ë¡ ì§€ì •í•˜ë©´ ë©ë‹ˆë‹¤.
<br />
`Error Boundary`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ ìª½ì—ì„œ ì˜¤ë¥˜ì˜ ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ëª©ì ìœ¼ë¡œìš”.

```tsx
import {
  Component,
  ComponentType,
  createElement,
  ReactNode,
  ErrorInfo,
} from 'react';

type ErrorBoundaryState = {
  hasError: boolean;
  error: Error | null;
}

type FallbackProps = {
  error: Error | null;
}

type ErrorBoundaryProps = {
  // fallback ìš©ë„ì˜ ì»´í¬ë„ŒíŠ¸ëŠ” Error ì •ë³´ë¥¼ propsë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì—¬ì•¼ í•œë‹¤.
  fallback: ComponentType<FallbackProps>;
  children: ReactNode;
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);

    this.state = {
      hasError: false,
      error: null,
    };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return {
      hasError: true,
      error,
    };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {
    console.log({ error, errorInfo })
  }

  render() {
    const { state, props } = this;

    const { hasError, error } = state;

    const { fallback, children } = props;

    const fallbackProps: FallbackProps = {
      error,
    };

    // fallback ì»´í¬ë„ŒíŠ¸ ì¸¡ì—ì„œ ì˜¤ë¥˜ ì •ë³´ë¥¼ propsë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì„¤ì •
    const fallbackComponent = createElement(fallback, fallbackProps);

    // ì˜¤ë¥˜ ë°œìƒ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ì—¬, ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ë•Œ ì¡°ê±´ë¶€ ë Œë”ë§ ì²˜ë¦¬ë¥¼ í•´ì¤ë‹ˆë‹¤.
    return hasError ? fallbackComponent : children;
  }
}
```

ìœ„ì²˜ëŸ¼ ì˜¤ë¥˜ ì •ë³´ë¥¼ **ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œ ì•Œ ìˆ˜ ìˆë„ë¡** propsë¥¼ ì„¤ì •í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const ChildComponent = () => {
  return (
    ...
  );
}

const ParentComponent = () => {
  return (
    <ErrorBoundary
      fallback={(({ error }) => {
        // ErrorBoundaryì—ì„œ ìºì¹˜ëœ ì˜¤ë¥˜ ì •ë³´ë¥¼ ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•´ì„œ ë°›ì„ ìˆ˜ ìˆê¸°ì—, ì˜¤ë¥˜ë³„ ì¼€ì´ìŠ¤ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        if (error.status === 404) {
          return <p>404 ì˜¤ë¥˜ì…ë‹ˆë‹¤.</p>
        }

        else if (error.status === 500) {
          return <p>500 ì˜¤ë¥˜ì—ìš”!</p>
        }
      })}
    >
      <ChildComponent />
    </ErrorBoundary>
  );
}
```

`Error Boundary` ì»´í¬ë„ŒíŠ¸ë¥¼ ì„¤ê³„í• ë•Œ, ì˜¤ë¥˜ì— ëŒ€í•œ ì •ë³´ë¥¼ `ë§¤ê°œë³€ìˆ˜`ë¡œ ë°›ì„ ìˆ˜ ìˆê¸°ë•Œë¬¸ì— ì˜¤ë¥˜ ì¼€ì´ìŠ¤ë³„ë¡œ ì¡°ê±´ë¶€ ë Œë”ë§ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì •ë§ í¸ë¦¬í•˜ì£ ?
<br />
í•˜ì§€ë§Œ ì•„ì§ í•´ê²°í•œ ë‹¨ì ì´ í•˜ë‚˜ ë‚¨ì•„ìˆëŠ”ë°ìš”, **ë§Œì•½ API ì˜¤ë¥˜ê°€ ë‚¬ì„ë•Œ ì¬ìš”ì²­ ì²˜ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ”ë°, ì–´ë–»ê²Œ êµ¬í˜„í•´ì•¼ í•˜ëŠ”ê°€?** í•­ëª©ì…ë‹ˆë‹¤. ì´ í•­ëª©ì˜ í•´ê²°ë²•ì€ ë°‘ ì„¹ì…˜ì—ì„œ ì¶”ê°€ë¡œ í•¨ê»˜ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤.

## 3. React-Queryì™€ í•¨ê»˜ ì‚¬ìš© ğŸš€
React-QueryëŠ” `Error Boundary` ì‚¬ìš©ì„ ì§€ì›í•˜ëŠ”ë°ìš”, ì‚¬ìš©ë°©ë²•ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. `useQuery` í›…ì˜ `useErrorBoundary` ì˜µì…˜ì„ `true`ë¡œ ì§€ì •í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ ë§ì´ì£ .

```typescript
import { useQuery } from '@tanstack/react-query';

const { data } = useQuery({
  queryKey: ['some key'],
  ...
  useErrorBoundary: true, // ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì‹¼ Error Boundaryì˜ ì²˜ë¦¬ í—ˆìš©ì—¬ë¶€
});
```

ìœ„ì²˜ëŸ¼ `useErrorBoundary` ì†ì„±ì„ `true`ë¡œ ì„¤ì •í•œ ë‹¤ìŒ, í•´ë‹¹ hookì„ í˜¸ì¶œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ `Error Boundary`ë¡œ ê°ì‹¸ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
const fetchData = async () => {
  // return something
}

const ChildComponent = () => {
  const { data } = useQuery({
    queryKey: ['some key'],
    queryFn: fetchData,
    useErrorBoundary: true, // ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì‹¼ Error Boundaryì˜ ì²˜ë¦¬ í—ˆìš©ì—¬ë¶€
  });

  return (
    <div>
      <h1>ì œëª©: {data.title}</h1>
      <p>ê¸€ ë‚´ìš©: {data.content}</p>
    </div>
  );
}

const ParentComponent = () => {
  return (
    <ErrorBoundary
      fallback={(({ error }) => {
        const status = error?.status;

        switch (status) {
          case 404:
            return (
              <p>404 ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</p>
            );

          case 500:
            return (
              <p>ì„œë²„ ì˜¤ë¥˜ì—ìš”!</p>
            );
        }
      })}
    >
      <ChildComponent />
    </ErrorBoundary>
  );
}
```

`React Query`ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ”, `useQuery` hookì„ í˜¸ì¶œí•œ **ì»´í¬ë„ŒíŠ¸ì˜ ìƒìœ„ì—ì„œ ê°ì‹¸ì•¼í•œë‹¤**ëŠ” ê·œì¹™ì„ ê¼­ ì•Œì•„ë‘ì…”ì•¼ í•©ë‹ˆë‹¤.

### 3-1. ì¬ìš”ì²­ ì²˜ë¦¬í•˜ê¸°
ì¼ë°˜ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ì—ì„œ ê°‘ì‘ìŠ¤ëŸ½ê²Œ ì˜¤ë¥˜ê°€ ë°œìƒí•œê²½ìš° **ë‹¤ì‹œ ì‹œë„í•˜ê¸°** ë²„íŠ¼ì„ í†µí•´ì„œ ì¬ìš”ì²­ ë™ì‘ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì—ì„œëŠ” `Error Boundary`ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?
<br />
ì°¸ê³ ë¡œ `React Query` ì—ì„œëŠ” ê°€ì¥ ê°€ê¹Œìš´ê³³ì—ì„œ `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ëŠ” `useQuery` hookì˜ ì˜¤ë¥˜ ìƒíƒœë¥¼ ì´ˆê¸°í™” ì‹œì¼œì£¼ëŠ” `QueryErrorResetBoundary` ì»´í¬ë„ŒíŠ¸ê°€ ìˆìŠµë‹ˆë‹¤.

> Query Error Reset Boundary ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•´ ì•Œê³ ì‹¶ë‹¤ë©´?
https://tanstack.com/query/v4/docs/react/reference/QueryErrorResetBoundary

`QueryErrorResetBoundary`ëŠ” `reset` í•¨ìˆ˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ì„œ JSXë¥¼ ë Œë”ë§í•˜ë„ë¡ ì„¤ê³„ëœ ì»´í¬ë„ŒíŠ¸ì¸ë°ìš”, `reset` í•¨ìˆ˜ëŠ” ì•„ê¹Œì „ì— ë§ì”€ë“œë¦° `useQuery` hookì˜ ì˜¤ë¥˜ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
<br />
ì´ì œ ìœ„ì˜ ì½”ë“œë¥¼ ì¡°ê¸ˆ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
return (
  <QueryErrorResetBoundary>
    {(({ reset }) => (
      <ErrorBoundary
        onReset={reset}
        fallback={renderFallback}
      >
        <ChildComponent />
      </ErrorBoundary>
    ))}
  </QueryErrorResetBoundary>
);
```

ì½”ë“œë¥¼ ë³´ì‹œë©´ `Error Boundary`ì— `onReset` ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ `reset` í•¨ìˆ˜ë¥¼ propsë¡œ ë„˜ê²¨ì£¼ë ¤ê³  í•˜ëŠ” ì´ìœ ëŠ”, `Error Boundary` ì»´í¬ë„ŒíŠ¸ ë‚´ì— ì •ì˜ëœ `hasError` ìƒíƒœë¥¼ `false`ë¡œ ë¦¬ì…‹í•˜ê¸° ìœ„í•¨ ì…ë‹ˆë‹¤.
<br />
ë§Œì•½ ì‚¬ìš©ìê°€ **ì¬ì‹œë„ ìš”ì²­**ì„ ë³´ëƒˆì„ë•ŒëŠ” ì˜¤ë¥˜ UIê°€ ì•„ë‹Œ ë¡œë”© UIë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ í•´ì•¼ê² ì£ ? ë”°ë¼ì„œ UIê°€ ë³€ê²½ë˜ì–´ì•¼í•¨ì„ `Error Boundary` ì»´í¬ë„ŒíŠ¸ì—ê²Œ ì•Œë¦¬ê¸° ìœ„í•´ì„œ `reset` í•¨ìˆ˜ë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.
<br />
`Error Boundary` ì»´í¬ë„ŒíŠ¸ì— `onReset` propsë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ì„œ `ErrorBoundary.tsx` íŒŒì¼ì„ ì•„ë˜ì²˜ëŸ¼ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```tsx
import {
  Component,
  ComponentType,
  createElement,
  ReactNode,
  ErrorInfo,
} from 'react';

type ErrorBoundaryState = {
  hasError: boolean;
  error: Error | null;
}

type FallbackProps = {
  error: Error | null;
  resetErrorBoundary: () => void; // resetErrorBoundary í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ”ìª½ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ propsë¡œ ì „ë‹¬
}

type ErrorBoundaryProps = {
  fallback: ComponentType<FallbackProps>;
  onReset: () => void;
  children: ReactNode;
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);

    this.state = {
      hasError: false,
      error: null,
    };

    this.resetErrorBoundary = this.resetErrorBoundary.bind(this); // this ë°”ì¸ë”© ì²˜ë¦¬
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    // ì˜¤ë¥˜ ìƒíƒœ ì—…ë°ì´íŠ¸
    return {
      hasError: true,
      error,
    };
  }

  resetErrorBoundary(): void {
    this.props.onReset();

    // ì—ëŸ¬ ìƒíƒœë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    this.setState({
      hasError: false,
      error: null,
    });
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {
    console.log({ error, errorInfo })
  }

  render() {
    const { state, props, resetErrorBoundary } = this;

    const { hasError, error } = state;

    const { fallback, children } = props;

    const fallbackProps: FallbackProps = {
      error,
      resetErrorBoundary, // props ì¶”ê°€
    };

    const fallbackComponent = createElement(fallback, fallbackProps);

    return hasError ? fallbackComponent : children;
  }
}
```

ê·¸ëŸ¬ë©´ ìµœì¢…ì ìœ¼ë¡œ `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œëŠ” ì•„ë˜ì²˜ëŸ¼ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆê² ë„¤ìš”.

```tsx
return (
  <QueryErrorResetBoundary>
    {(({ reset }) => (
      <ErrorBoundary
        onReset={reset}
        fallback={(({ error, resetErrorBoundary }) => {
          const status = error?.status;

          switch (status) {
            case 404:
              return (
                <p>404 ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</p>
              );

            case 500:
              return (
                <div>
                  <p>ì„œë²„ ì˜¤ë¥˜ì—ìš”!</p>

                  <button onClick={resetErrorBoundary}>ì¬ì‹œë„</button>
                </div>
              );
          }
        })}
      >
        <ChildComponent />
      </ErrorBoundary>
    ))}
  </QueryErrorResetBoundary>
);
```

ìœ„ì—ì„œ `resetErrorBoundary` í•¨ìˆ˜ ë˜í•œ ì´ì „ì— `error` ë³€ìˆ˜ì²˜ëŸ¼ propsìš© í•¨ìˆ˜ì—ì„œ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•´ì£¼ì—ˆëŠ”ë°ìš”. ì´ëŠ” `Error Boundary`ì˜ `hasError` ìƒíƒœ ì´ˆê¸°í™” ë™ì‘, `reset` í•¨ìˆ˜ì˜ ë™ì‘ì´ í•©ì³ì§„ í•¨ìˆ˜ë¥¼ `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•˜ê¸°ìœ„í•¨ ì…ë‹ˆë‹¤.
<br />
ë³´í†µ ì˜¤ë¥˜ UIì•ˆì— `ì¬ì‹œë„ í•˜ê¸°` ë²„íŠ¼ì´ ìœ„ì¹˜í•  ìˆ˜ ìˆëŠ” ìƒí™©ì´ ë§ê¸° ë•Œë¬¸ì— ì´ë¥¼ ëŒ€ë¹„í•  ìˆ˜ ìˆì£ .

### 3-2. ì„ íƒì  useErrorBoundary
ë§Œì•½ `Error Boundary`ë¥¼ ì‚¬ìš©í•˜ì‹œë‹¤ê°€ ì´ëŸ°ìƒí™©ì— ë§ˆì£¼í•˜ì‹¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

> ì €ëŠ” 400ê³¼ 500 Status ì—ëŸ¬ì¼ë•ŒëŠ” Error Boundaryë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì€ë°, ë‚˜ë¨¸ì§€ Status ì—ëŸ¬ì¼ë•ŒëŠ” ì‚¬ìš©í•˜ê³  ì‹¶ì§€ ì•Šì•„ìš”.

ì°¸ê³ ë¡œ ìœ„ì—ì„œ ë§ì”€ë“œë¦° `useQuery` hookì˜ `useErrorBoundary` ì†ì„±ì€ ë‹¨ìˆœ `boolean` íƒ€ì…ì´ ì•„ë‹Œ, `boolean` íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¡œë„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
{
  useErrorBoundary: boolean | ((error: unknown) => boolean);
}
```

ê·¸ë¦¬ê³  í•¨ìˆ˜ì—ì„œëŠ” ì˜¤ë¥˜ ì •ë³´ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆê¸°ë•Œë¬¸ì—, ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¡°ê±´ë¶€ ì²˜ë¦¬ë¥¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

```typescript
useQuery({
  useErrorBoundary: (error) => {
    // ì˜¤ë¥˜ Statusê°€ 400ì´ê±°ë‚˜ 500ì¼ë•Œë§Œ Error Boundary ì‚¬ìš©í•˜ë„ë¡.
    return error.status === 400 || error.status === 500;
  }
})
```

## 4. ë§ˆì¹˜ë©° ğŸ“Œ
ì˜¤ëŠ˜ì€ ë¦¬ì•¡íŠ¸ì˜ `Error Boundary`ë€ ë¬´ì—‡ì´ë©°, ì´ë¥¼ `React Query`ì™€ í•¨ê»˜ í™œìš©í•´ë³´ë©´ì„œ ê° ì¼€ì´ìŠ¤ë³„ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.
<br />
ì§€ê¸ˆ ë‹¹ì¥ì€ ì´í•´í•˜ê¸° ì–´ë ¤ìš°ì‹¤ìˆ˜ë„ ìˆì§€ë§Œ, ì§ì ‘ ë„ì „í•´ë³´ë©´ì„œ ì—¬ëŸ¬ë²ˆ ì½ìœ¼ì‹œë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤. ğŸ˜›
<br />
ì´ìƒìœ¼ë¡œ ê¸€ì„ ë§ˆë¬´ë¦¬ í•˜ê² ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ§‘â€ğŸ«