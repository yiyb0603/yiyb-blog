---
title: Reusable Workflowë¡œ GitHub Actions ì›Œí¬í”Œë¡œìš° ì¬ì‚¬ìš©í•˜ê¸°
description: GitHub Actionsì˜ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì§ì„ ì¬ì‚¬ìš© í•´ë³´ê² ìŠµë‹ˆë‹¤.
createdAt: 2023-10-19
thumbnail: /images/posts/develop/github-actions-reusable-workflow/thumbnail.png
---

ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ GitHub Actionsì˜ `Reusable Workflow`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›Œí¬í”Œë¡œìš° ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## 1. ê¸°ì¡´ ë¬¸ì œì  ğŸ¤”

ì €ëŠ” íšŒì‚¬ì—ì„œ í”„ë¡œì íŠ¸ë“¤ì˜ ì½”ë“œë¥¼ ìì£¼ ìœ ì§€ë³´ìˆ˜ í•˜ê±°ë‚˜ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì˜ ê°œë°œì„ ë§¡ì•„ì„œ ê°œë°œí•˜ê¸°ë„ í•˜ëŠ”ë°ìš”. ë‹¤ì–‘í•œ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ê±°ì˜ ë³€í•˜ì§€ ì•ŠëŠ” íŒŒì¼ì´ ìˆì—ˆëŠ”ë°, ê·¸ê²ƒì€ ë°”ë¡œ `GitHub Actions` **ì›Œí¬í”Œë¡œìš° ìŠ¤í¬ë¦½íŠ¸**ì˜€ìŠµë‹ˆë‹¤.

í˜„ì¬ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” `workflow`ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

> actions í™˜ê²½ ì„¸íŒ… -> ì˜ì¡´ì„± ì„¤ì¹˜ -> í”„ë¡œì íŠ¸ ë¹Œë“œ -> S3 ì •ì  ìì› ì—…ë¡œë“œ -> Vercel ë°°í¬

íšŒì‚¬ í”„ë¡œì íŠ¸ëŠ” ê±°ì˜ ë‹¤ `Vercel`ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬, `S3`ë¥¼ Storageë¡œ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ë¼ë¦¬ `workflow` ì½”ë“œê°€ ê±°ì˜ ê°™ìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê¸°ì¡´ `workflow`ì— ë¬¸ì œê°€ ë°œìƒí–ˆì„ë•ŒëŠ” ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë“¤ì˜ `workflow`ë¥¼ ëª¨ë‘ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ê·€ì°®ì€ì¼ì´ ìƒê¸°ì£ . ğŸ¥²

<br />

ê·¸ë˜ì„œ ì €ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ê³ ë¯¼í•˜ë‹¤ê°€, ìµœê·¼ì— **GitHub Actions**ì—ì„œ ì œê³µí•˜ëŠ” `Reusable Workflow (ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì›Œí¬í”Œë¡œìš°)`ë¥¼ ì•Œê²Œë˜ì–´ì„œ ê³µí†µìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆì—ˆë˜ ê²½í—˜ì„ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤.

## 2. ì–´ë–¤ íŠ¹ì§•ì´ ìˆëŠ”ê°€? ğŸ“’

`Reusable Workflow`ì˜ ê°€ì¥ í° íŠ¹ì§•ì€ ë§ˆì¹˜ ì›Œí¬í”Œë¡œìš° ì½”ë“œë¥¼ í•¨ìˆ˜ ëª¨ë“ˆì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”íˆ í•¨ìˆ˜ ëª¨ë“ˆì´ë¼ê³  í•œë‹¤ë©´ ì›í•˜ëŠ” ì¸ìë¥¼ ë„˜ê²¨ì„œ ê·¸ì—ë§ëŠ” ê²°ê³¼ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ì£ ?

`Reusable Workflow`ë„ ë˜‘ê°™ìŠµë‹ˆë‹¤! ìì‹ ì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ì²˜ì—ì„œ ì–´ë– í•œ ê°’ì„ ë„˜ê²¨ì¤˜ì•¼ í•˜ëŠ”ì§€ë¥¼ ì •ì˜í•´ì¤„ ìˆ˜ ìˆì£ . ì•„ë˜ì˜ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.

```yaml
name: Resuable Workflow Example

on:
  workflow_call: # ì›Œí¬í”Œë¡œìš°ê°€ í˜¸ì¶œë ë•Œ
    inputs: # ì‚¬ìš©ì²˜ë¡œë¶€í„° ì…ë ¥ë°›ì„ ì¸ì
      value: # ì¸ì ì´ë¦„
        required: true # í•„ìˆ˜ ì—¬ë¶€
        type: string # ì¸ì íƒ€ì…
      print_value:
        required: false
        type: boolean
        default: true # ì¸ì ê¸°ë³¸ê°’ (optional)

jobs:
  reusable-workflow:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.0

      - name: What is passed value?
        if: ${{ inputs.print_value == true }} # inputs í•„ë“œë¥¼ í†µí•´ì„œ ì ‘ê·¼ ê°€ëŠ¥
        run: echo ${{ inputs.value }} # inputs í•„ë“œë¥¼ í†µí•´ì„œ ì ‘ê·¼ ê°€ëŠ¥

      - name: What is Secret value?
        run: echo ${{ secrets.SECRET_KEY }}
```

ì›Œí¬í”Œë¡œìš°ê°€ í˜¸ì¶œë ë•Œ(on workflow_call) ì „ë‹¬ë°›ì„ ì¸ìë“¤ì„ ì •ì˜í•œ í›„, ë°‘ì— ìˆëŠ” stepsì—ì„œ `inputs` í•„ë“œë¡œ ì¸ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë§ í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©ê°€ëŠ¥í•˜ì£ ?

<br />

ë°‘ ì„¹ì…˜ë¶€í„°ëŠ” `Reusable Workflow`ì˜ ì„¤ì • ë° ì‚¬ìš©ë°©ë²•ì„ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## 3. ê³µí†µ ëª¨ë“ˆ ë ˆí¬ì§€í† ë¦¬ ìƒì„± ğŸ”¨

ë¨¼ì € `Reusable Workflow`ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°ìš”. ì œê°€ ì´ë²ˆê¸€ì—ì„œ ì„¤ëª…ë“œë¦´ ë°©ë²•ì€ í•˜ë‚˜ì˜ Repositoryì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  `Reusable Workflow`ë¥¼ ë§Œë“¤ê³ , ì´ë¥¼ ì‚¬ìš©í•˜ë ¤ëŠ” ë‹¤ë¥¸ Repositoryì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

<br />

ì›ë˜ëŠ” Organization ë‚´ì—ì„œ privateìœ¼ë¡œ ì„ ì–¸ëœ ê³µí†µ Repositoryì— ëŒ€í•´ì„œ `Reusable Workflow`ê°€ ì‚¬ìš© ë¶ˆê°€ëŠ¥í–ˆì—ˆëŠ”ë°, **2022ë…„ 12ì›”ë¶€í„° ì‚¬ìš©ê°€ëŠ¥**í•˜ë„ë¡ ì—…ë°ì´íŠ¸ ë˜ì—ˆë„¤ìš”.

> ê´€ë ¨ ì—…ë°ì´íŠ¸ ê¸€ â¬‡ï¸
> https://github.blog/changelog/2022-12-14-github-actions-sharing-actions-and-reusable-workflows-from-private-repositories-is-now-ga

ë¨¼ì € `Reusable Workflow`ë¥¼ ì €ì¥í•´ë‘˜ Repositoryë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì¤ì‹œë‹¤. ì €ëŠ” **reusable-workflows**ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë§Œë“¤ì—ˆì–´ìš”.

![Repository ìƒì„±](/images/posts/develop/github-actions-reusable-workflow/create-repository.png)

ê·¸ëŸ¬ê³ ë‚˜ì„œ `.github/workflows/reusable-workflow.yaml` ê²½ë¡œì— íŒŒì¼ì„ ë§Œë“¤ê³ , ë‘ë²ˆì§¸ ì„¹ì…˜ì—ì„œ ì œê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.

![Workflow íŒŒì¼ ì¶”ê°€](/images/posts/develop/github-actions-reusable-workflow/create-workflow-file.png)

### 3-1. ì•¡ì„¸ìŠ¤ í—ˆìš©í•˜ê¸° âœ…

ìœ„ ê³¼ì •ì„ í†µí•´ì„œ `Reusable Workflow` ì‘ì„±ì€ ê°„ë‹¨í•˜ê²Œ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ ì›Œí¬í”Œë¡œìš°ë¥¼ ë‹¤ë¥¸ Repositoryì—ì„œ ì‚¬ìš©í•´ë³´ê¸° ì „ì— í•„ìˆ˜ë¡œ ì„¤ì •í•´ì•¼í•˜ëŠ” í•­ëª©ì´ ìˆëŠ”ë°ìš”, ë°”ë¡œ **GitHub Actions**ì˜ `ì•¡ì„¸ìŠ¤`ë¥¼ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ëŠ” ë°©ë²•ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. `Repository ì„¤ì • -> Actions -> General` ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤ìŒ, ë§¨ ë°‘ìœ¼ë¡œ ìŠ¤í¬ë¡¤ í•˜ì‹œë©´ ì•„ë˜ì˜ ì„¤ì •ë€ì´ ìˆìŠµë‹ˆë‹¤.

![GitHub Actions ì•¡ì„¸ìŠ¤ í—ˆìš©](/images/posts/develop/github-actions-reusable-workflow/workflow-access.png)

ì´ ì„¤ì •ë€ì´ ë¬´ì—‡ì´ëƒë©´ ë‹¤ë¥¸ Repositoryì˜ ì›Œí¬í”Œë¡œìš°ì—ì„œ í•´ë‹¹ Repositoryì˜ `Reusable Workflow`ì— ì ‘ê·¼ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ì„¤ì •í•˜ëŠ”ë°ìš”. ì €í¬ì˜ ëª©ì ì€ ì¬ì‚¬ìš©ì´ë¯€ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ì„ íƒëœ **Not accessible**ì„ ì„ íƒ í•´ì œí•˜ê³ , **Accessible from repositories owned by the user**ë¥¼ ì„ íƒí•œë‹¤ìŒ `Save ë²„íŠ¼`ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

### 3-2. ì¬ì‚¬ìš© ì›Œí¬í”Œë¡œìš° ì‚¬ìš© â™»ï¸

ì´ì œ ìƒˆë¡œìš´ Repositoryë¥¼ ë§Œë“¤ì–´ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¬ì‚¬ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì €ëŠ” **actions-project**ë¼ëŠ” ì´ë¦„ì˜ Repositoryë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

<br />

ê·¸ë¦¬ê³  í•´ë‹¹ Repositoryì—ì„œ `.github/workflows/actions.yaml` ê²½ë¡œì— ì›Œí¬í”Œë¡œìš° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

```yaml
name: Actions Script

on:
  push:
    branches:
      - main

jobs:
  use-reusable-workflow:
    uses: yiyb0603/reusable-workflows/.github/workflows/reusable-workflow.yaml@main # reusable workflow ìœ„ì¹˜
    with: # reusable workflowì— ì „ë‹¬í•  ì¸ì
      value: ë‚˜ëŠ” Actions Project ë ˆí¬
```

ìœ„ì˜ ì½”ë“œì—ì„œ `uses` í•„ë“œì— ì›Œí¬í”Œë¡œìš° ì£¼ì†Œë¥¼ ì ì–´ì£¼ì—ˆëŠ”ë°ìš”. ì£¼ì†Œ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> (ì‚¬ìš©ì ì´ë¦„)/(Repository ì´ë¦„)/(ì›Œí¬í”Œë¡œìš° íŒŒì¼ ê²½ë¡œ)@(ref)

ìœ„ í˜•ì‹ì„ ë§ì¶”ê¸° ìœ„í•´ì„œ ì €ëŠ” ì•„ë˜ì²˜ëŸ¼ ê°’ì„ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

| í•„ë“œ                 | ê°’                                       |
| -------------------- | ---------------------------------------- |
| ì‚¬ìš©ì ì´ë¦„          | yiyb0603                                 |
| Repository ì´ë¦„      | reusable-workflow                        |
| ì›Œí¬í”Œë¡œìš° íŒŒì¼ ê²½ë¡œ | .github/workflows/reusable-workflow.yaml |
| ref                  | main                                     |

ë§ˆì§€ë§‰ìœ¼ë¡œ ë¶™ëŠ” ref ê°’ì€ **ë¸Œëœì¹˜ ì´ë¦„, ë¦´ë¦¬ì¦ˆ íƒœê·¸ ì´ë¦„, ì»¤ë°‹ SHA**ì¤‘ ì•„ë¬´ ê°’ìœ¼ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ”ë°ìš”. ì €ëŠ” ë¸Œëœì¹˜ ì´ë¦„ì„ ì„ íƒí–ˆê¸° ë•Œë¬¸ì— **main**ì´ë¼ê³  ì ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.

<br />

`with` í•„ë“œì—ëŠ” `Reusable Workflow`ì—ì„œ ì •ì˜í•œ ì¸ìë¥¼ ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ VSCodeë¥¼ ì‚¬ìš©í•˜ì‹¤ë•Œ [GitHub Actions Extensions](https://marketplace.visualstudio.com/items?itemName=GitHub.vscode-github-actions)ë¥¼ ì„¤ì¹˜í•˜ì‹œë©´, `required` ì¸ìì— ëŒ€í•´ì„œ ì˜¤ë¥˜ë¥¼ ìºì¹˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì •ë§ ìœ ìš©í•©ë‹ˆë‹¤. ê°•ë ¥ ì¶”ì²œë“œë ¤ìš” ğŸ‘

![GitHub Actions Extensions](/images/posts/develop/github-actions-reusable-workflow/vscode-extensions.png)

<br />

ì €ëŠ” `main` ë¸Œëœì¹˜ì—ì„œ `push` ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚¬ì„ë•Œ Actionsë¥¼ ì‹¤í–‰í•˜ê¸°ë¡œ ì •ì˜í•´ë†¨ìŠµë‹ˆë‹¤. ì»¤ë°‹ í›„ ì›Œí¬í”Œë¡œìš°ì˜ ê²°ê³¼ë¥¼ ë´…ì‹œë‹¤.

![ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê²°ê³¼](/images/posts/develop/github-actions-reusable-workflow/workflow-result.png)

`with` í•„ë“œì— ë„˜ê²¨ì¤€ **ë‚˜ëŠ” Actions Project ë ˆí¬**ë¼ëŠ” ê°’ì´ ì˜ ë‹´ê²¨ì„œ ë‚˜ì˜µë‹ˆë‹¤. ì´ëŸ°ì‹ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš°ì— ì¸ìë¥¼ ë„˜ê²¨ì„œ í™œìš©í•  ìˆ˜ ìˆì–´ìš”.

### 3-3. Secrets ê°’ ì‚¬ìš©í•˜ê¸° ğŸ”’

`Reusable Workflow`ì—ì„œ `secrets` ê°’ì„ ì°¸ì¡°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í• ê¹Œìš”? ëŒ€í‘œì ì¸ ë‘ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

<br />

**ì²«ë²ˆì§¸**ëŠ” ê·¸ëƒ¥ ë‹¨ìˆœí•˜ê²Œ `inputs` í•„ë“œì—ì„œ ë°›ì„ ê°’ì„ ì •ì˜í•˜ê³ , `with` í•„ë“œì—ì„œ ì¸ìë¥¼ ë„˜ê¸¸ë•Œ ì‹œí¬ë¦¿ê°’ìœ¼ë¡œ ë„˜ê²¨ì„œ í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

```yaml
name: Resuable Workflow Example

on:
  workflow_call:
    inputs:
      value:
        required: true
        type: string

jobs:
  reusable-workflow:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.0

      - name: What is passed value?
        run: echo ${{ inputs.value }}
```

```yaml
name: Actions Script

on:
  push:
    branches:
      - main

jobs:
  use-reusable-workflow:
    uses: yiyb0603/reusable-workflows/.github/workflows/reusable-workflow.yaml@main # reusable workflow ìœ„ì¹˜
    with: # reusable workflowì— ì „ë‹¬í•  ì¸ì
      value: ${{ secrets.SECRET_VALUE }}
```

<br />

**ë‘ë²ˆì§¸**ëŠ” ì‹œí¬ë¦¿ ê°’ì„ í†µì§¸ë¡œ ë„˜ê²¨ì„œ `Reusable Workflow`ì—ì„œ `secrets`ì— ì ‘ê·¼í•  ë•Œ ìì‹ ì´ í˜¸ì¶œëœ Repositoryì˜ ì‹œí¬ë¦¿ ê°’ì„ ì°¸ì¡°í•˜ë„ë¡ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì œê°€ ìƒê°í–ˆì„ë•Œ ì´ ë°©ë²•ì„ ì“°ëŠ” ê²½ìš°ëŠ” `Organization Secrets`ë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ëŠ” í™˜ê²½ì´ê³ , Repositoryë§ˆë‹¤ ì‹œí¬ë¦¿ ê°’ì´ ì°¨ì´ê°€ ì—†ëŠ” ê²½ìš°ì— ì‚¬ìš©í•  ìˆ˜ ìˆì„ê²ƒ ê°™ë„¤ìš”.

```yaml
name: Resuable Workflow Example

on:
  workflow_call:

jobs:
  reusable-workflow:
    runs-on: ubuntu-latest

    steps:
      - name: What is passed value?
        run: echo ${{ inputs.value }}
```

```yaml
name: Actions Script

on:
  push:
    branches:
      - main

jobs:
  use-reusable-workflow:
    uses: yiyb0603/reusable-workflows/.github/workflows/reusable-workflow.yaml@main
    secrets: inherit # ì¤‘ìš”!
```

Reusable Workflowë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ì²˜ì—ì„œ `secrets: inherit` ì˜µì…˜ì„ ë„£ì–´ì£¼ë©´ ì‚¬ìš©ì²˜ Repositoryì˜ ì‹œí¬ë¦¿ ê°’ì„ ì¬ì‚¬ìš© ì›Œí¬í”Œë¡œìš° ì¸¡ì—ì„œ ì°¸ì¡°í•©ë‹ˆë‹¤.

> ì•„ì‰½ê²Œë„ Reusable Workflowê°€ ì €ì¥ëœ Repositoryì˜ ì‹œí¬ë¦¿ ê°’ì€ ì‚¬ìš©ì²˜ì—ì„œ ì‹¤í–‰ì‹œ ì°¸ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ğŸ¥²

## 4. ì‹¤ë¬´ì—ì„œ ì‚¬ìš© ğŸ§ª

ì œê°€ ì²«ë²ˆì§¸ ì„¹ì…˜ì—ì„œ ì„¤ëª…ë“œë ¸ë˜ í˜„ì¬ íšŒì‚¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ê¸°ì–µí•˜ê³  ê³„ì‹ ê°€ìš”? `Vercel`ì„ ì‚¬ìš©í•œ ì €í¬ íšŒì‚¬ì˜ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¼ë¶€ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

<br />

**ìì„¸í•œ ì„¤ëª…ì€ ì½”ë“œ ë‚´ì— ì£¼ì„ìœ¼ë¡œ ì ì–´ë‘ì—ˆìŠµë‹ˆë‹¤.**

```yaml
name: Resuable Vercel Deploy Workflow

on:
  workflow_call:
    inputs:
      environment: # ì‹¤í–‰ í™˜ê²½ (production or preview)
        required: true
        type: string
      vercel_scope: # Vercel ê³„ì • ìŠ¤ì½”í”„
        required: true
        type: string
      aws_end_point_url:
        default: https://s3.ap-northeast-2.amazonaws.com
        required: false
        type: string
      s3_bucket_path: # S3 ì—…ë¡œë“œ ì €ì¥ ê²½ë¡œ
        required: false
        type: string

jobs:
  reusable-vercel-workflow:
    runs-on: ubuntu-latest

    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_DEFAULT_REGION: ap-northeast-2

    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.0

      - uses: actions/setup-node@v3
        with:
          node-version: '18.18.0'

      - name: Install Vercel CLI
        run: npm install -g vercel@latest

        # production, preview í™˜ê²½ë§ˆë‹¤ í™˜ê²½ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ ì¡°ê¸ˆì”© ë‹¤ë¦„
      - name: Update Vercel Environment Variables
        run: |
          if [ '${{ inputs.environment }}' == 'production' ]; then
            vercel pull --yes --environment=production --scope=${{ inputs.vercel_scope }} --token=${{ secrets.VERCEL_TOKEN }}
          else
            vercel pull --yes --environment=preview --git-branch="${{ github.ref_name }}" --scope=${{ inputs.vercel_scope }} --token=${{ secrets.VERCEL_TOKEN }}
          fi

      - name: Caching Yarn Dependencies
        id: yarn-cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('**/yarn.lock') }}

      - name: Install Dependencies
        if: steps.yarn-cache.outputs.cache-hit != 'true'
        run: yarn install

        # production, preview í™˜ê²½ë§ˆë‹¤ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì¡°ê¸ˆì”© ë‹¤ë¦„
      - name: Vercel Build
        run: |
          if [ '${{ inputs.environment }}' == 'production' ]; then
            vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
          else
            vercel build --token=${{ secrets.VERCEL_TOKEN }}
          fi

      # í”„ë¡œì íŠ¸ë§ˆë‹¤ ë‹¤ë¥¸ S3 ì €ì¥ì†Œ ìœ„ì¹˜ë¥¼ inputs í•„ë“œë¡œ ë„£ì–´ì¤„ ìˆ˜ ìˆë„ë¡
      - name: Upload Static Files to S3
        if: inputs.s3_bucket_path != ''
        run: |
          aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}

          aws --endpoint-url=${{ inputs.aws_end_point_url }} s3 cp .vercel/output/static/ s3://${{ inputs.s3_bucket_path }}/public/ --exclude '_next/*' --recursive
          aws --endpoint-url=${{ inputs.aws_end_point_url }} s3 cp .vercel/output/static/_next/static/ s3://${{ inputs.s3_bucket_path }}/_next/static/ --recursive

        # production, preview í™˜ê²½ë§ˆë‹¤ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì¡°ê¸ˆì”© ë‹¤ë¦„
      - name: Vercel Deploy
        run: |
          if [ '${{ inputs.environment }}' == 'production' ]; then
            vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
          else
            vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }}
          fi
```

ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ í•´ë‹¹ `Reusable Workflow`ë¥¼ ì‚¬ìš©í• ë•ŒëŠ” ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

```yaml
name: Vercel Production Deploy
on:
  release:
    types:
      - published

jobs:
  production-deploy:
    uses: Organization/github-action-modules/.github/workflows/vercel-deploy.yaml@main
    with:
      environment: production
      vercel_scope: scope
      s3_bucket_path: public-cdn/project1
    secrets: inherit
```

ì €í¬ í”„ë¡œì íŠ¸ë“¤ì—ì„œëŠ” Repository ì‹œí¬ë¦¿ ê°’ë“¤ì´ ê±°ì˜ ëŒ€ë¶€ë¶„ ìœ ì‚¬í•˜ë¯€ë¡œ `secrets: inherit`ì„ í†µí•´ ì‹œí¬ë¦¿ ê°’ì„ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

<br />

ê¸°ì¡´ì— `Reusable Workflow`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ë•ŒëŠ” ì €ë ‡ê²Œ ê¸´ ì›Œí¬í”Œë¡œìš°ë¥¼ ë§¤ë²ˆ ë³µë¶™í–ˆì—ˆëŠ”ë°.. `Reusable Workflow`ë¥¼ ì‚¬ìš©í•˜ê³ ë‚˜ì„œëŠ” ë³µë¶™í•˜ëŠ” ì¼ë„ ì—†ê³ , ì½”ë“œë„ ì •ë§ ì§§ì•„ì¡Œë„¤ìš”. ğŸ˜ƒ

## 5. ë§ˆì¹˜ë©° ğŸ“Œ

ì˜¤ëŠ˜ì€ `Reusable Workflow`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ ì œê°€ ì‹¤ë¬´ì—ì„œ ê²½í—˜í•œ ì´ì•¼ê¸°ë¥¼ ì•Œë ¤ë“œë¦° ì‹œê°„ì´ ë˜ì—ˆë„¤ìš”. ê°œë°œìë¡œì„œ ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì„ í•´ê²°í•˜ê³ ë‚˜ë©´ ê¸°ë¶„ì´ ì •ë§ ì¢‹ë„¤ìš”. ğŸ˜ƒ

<br />

ì œê°€ ì•Œë ¤ë“œë¦° ì •ë³´ê°€ ë§ì€ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì´ìƒìœ¼ë¡œ ê¸€ì„ ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ˜ƒ
